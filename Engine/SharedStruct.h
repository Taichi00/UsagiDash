#pragma once
#include "d3dx12.h"
#include <DirectXMath.h>
#include "ComPtr.h"
#include "Engine.h"
#include "BoneList.h"
#include "Vec.h"
#include <string>

class Texture2D;
class VertexBuffer;
class IndexBuffer;
class ConstantBuffer;
class PipelineState;
class DescriptorHandle;
class DescriptorHeap;
class RootSignature;
class Bone;

using namespace DirectX;

struct Vertex
{
	XMFLOAT3 Position;	// 位置座標
	XMFLOAT3 Normal;	// 法線
	XMFLOAT2 UV;		// uv座標
	XMFLOAT3 Tangent;	// 接空間
	XMFLOAT4 Color;		// 頂点色
	XMUINT4  BoneIndices;
	XMFLOAT4 BoneWeights;
	UINT BoneNum = 0;

	static const D3D12_INPUT_LAYOUT_DESC InputLayout;
private:
	static const int InputElementCount = 8;
	static const D3D12_INPUT_ELEMENT_DESC InputElements[InputElementCount];
};

struct alignas(256) Transform
{
	XMMATRIX World;	// ワールド行列
	XMMATRIX View;		// ビュー行列
	XMMATRIX Proj;		// 投影行列
};

struct alignas(256) Light
{
	XMMATRIX View;
	XMMATRIX Proj;
	XMFLOAT4 Color;
	XMFLOAT3 Direction;
};

struct alignas(256) BoneParameter
{
	XMFLOAT4X4 bone[512];
};

struct alignas(256) MaterialParameter
{
	XMFLOAT4 BaseColor;
	float OutlineWidth;
};

struct Mesh
{
	std::vector<Vertex> Vertices;	// 頂点データの配列
	std::vector<uint32_t> Indices;	// インデックスの配列
	VertexBuffer* pVertexBuffer;	// 頂点バッファへのポインタ
	IndexBuffer* pIndexBuffer;		// インデックスバッファへのポインタ
	int MaterialIndex;
};

struct Material
{
	Texture2D* Texture;
	DescriptorHandle* pHandle;
	PipelineState* pPipelineState;
	int AlphaMode;
	XMFLOAT4 BaseColor;
};

struct Model
{
	std::vector<Mesh> Meshes;
	std::vector<Material> Materials;
	BoneList Bones;
};